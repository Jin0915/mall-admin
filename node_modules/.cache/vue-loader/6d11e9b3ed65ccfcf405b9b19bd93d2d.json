{"remainingRequest":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/src/views/Auth/Role-Config.vue?vue&type=style&index=0&id=296be5cc&lang=scss&scoped=true&","dependencies":[{"path":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/src/views/Auth/Role-Config.vue","mtime":1573870081728},{"path":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mac/Desktop/上课教材资源/vue商城项目/mall-admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.menu-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\n\t.menu-title {\n\t\tcolor: #409EFF;\n\t}\n}\n\n.menu-box {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tcolor: #909399;\n}\n",{"version":3,"sources":["Role-Config.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2GA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"Role-Config.vue","sourceRoot":"src/views/Auth","sourcesContent":["<template>\n\t<div>\n\t\t<el-card class=\"am-margin-bottom-sm\" v-for=\"(item,index) in menu\" :key=\"item.id\">\n\t\t\t<div slot=\"header\" class=\"menu-header\">\n\t\t\t\t<div class=\"menu-title am-text-sm\">\n\t\t\t\t\t<i class=\"el-icon-collection-tag\"></i>\n\t\t\t\t\t{{item.name}}\n\t\t\t\t</div>\n\t\t\t\t<el-switch @change=\"parentHandle(item)\" v-model=\"item.checked\"></el-switch>\n\t\t\t</div>\n\t\t\t<el-row :gutter=\"40\">\n\t\t\t\t<el-col v-for=\"element in item.children\" :key=\"element.id\">\n\t\t\t\t\t<div class=\"menu-box am-padding-vertical-xs\">\n\t\t\t\t\t\t<div class=\"am-text-xs\">{{element.name}}</div>\n\t\t\t\t\t\t<el-switch @change=\"childHandle(element,item)\" v-model=\"element.checked\"></el-switch>\n\t\t\t\t\t</div>\n\t\t\t\t</el-col>\n\t\t\t</el-row>\n\t\t</el-card>\n\t</div>\n</template>\n\n<script>\n\timport { Role } from \"@/api/index\";\n\n\texport default {\n\t\tname: \"Role-Setting\",\n\t\tprops: [\"id\"],\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tmenu: [],\n\t\t\t};\n\t\t},\n\t\tcreated() {\n\t\t\tthis.loadRoleConfig();\n\t\t},\n\t\twatch: {\n\t\t\t// 如果路由有变化，会再次执行该方法\n\t\t\t'$route': 'loadRoleConfig'\n\t\t},\n\t\tmethods: {\n\t\t\tasync loadRoleConfig() {\n\t\t\t\tlet { status, data } = await Role.loadConfig({ id: this.id });\n\t\t\t\tif (status) {\n\t\t\t\t\tthis.menu = data;\n\t\t\t\t}\n\t\t\t},\n\t\t\t/*\n\t\t\t * 父级菜单switch\n\t\t\t * nodeData      父级菜单\n\t\t\t * */\n\t\t\tasync parentHandle({ checked, children, id }) {\n\t\t\t\t//修改父级菜单\n\t\t\t\tif (checked) {\n\t\t\t\t\tlet { status } = await Role.createMenu({ role_id: this.id, menu_id: id });\n\t\t\t\t} else {\n\t\t\t\t\tlet { status } = await Role.removeMenu({ role_id: this.id, menu_id: id });\n\t\t\t\t}\n\t\t\t\t//所有子级跟随父级状态改变\n\t\t\t\tchildren.forEach(async (item) => {\n\t\t\t\t\tif (checked) {\n\t\t\t\t\t\tlet { status } = await Role.createMenu({ role_id: this.id, menu_id: item.id });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet { status } = await Role.removeMenu({ role_id: this.id, menu_id: item.id });\n\t\t\t\t\t}\n\t\t\t\t\titem.checked = checked;\n\t\t\t\t});\n\t\t\t},\n\t\t\t/*\n\t\t\t * 子级菜单switch,子级菜单有一个选中，父级选中\n\t\t\t * nodeData    子级data\n\t\t\t * parentData  父级data\n\t\t\t * */\n\t\t\tasync childHandle({ checked, id }, parentData) {\n\t\t\t\t//检测子级菜单中是否有选中状态\n\t\t\t\tlet num = parentData.children.reduce((total, item) => {\n\t\t\t\t\tif (item.checked) {\n\t\t\t\t\t\ttotal++;\n\t\t\t\t\t}\n\t\t\t\t\treturn total;\n\t\t\t\t}, 0);\n\t\t\t\t// 修改当前子级菜单的选中状态\n\t\t\t\tif (checked) {\n\t\t\t\t\tlet { status } = await Role.createMenu({ role_id: this.id, menu_id: id });\n\t\t\t\t} else {\n\t\t\t\t\tlet { status } = await Role.removeMenu({ role_id: this.id, menu_id: id });\n\t\t\t\t\t// 点击的子菜单由true变为false,选中的子菜单总数为1时，避免重复发送父级菜单选中的ajax\n\t\t\t\t\tif (num == 1) return;\n\t\t\t\t}\n\t\t\t\tswitch (num) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tawait Role.removeMenu({ role_id: this.id, menu_id: parentData.id });\n\t\t\t\t\t\tparentData.checked = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tawait Role.createMenu({ role_id: this.id, menu_id: parentData.id });\n\t\t\t\t\t\tparentData.checked = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n\t.menu-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\n\t\t.menu-title {\n\t\t\tcolor: #409EFF;\n\t\t}\n\t}\n\n\t.menu-box {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tcolor: #909399;\n\t}\n</style>\n"]}]}